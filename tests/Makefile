TESTDIR		= tests

TESTBINDIR	= $(TESTDIR)/bin
TESTSRCDIR	= $(TESTDIR)/src

TESTSRCFILES	= $(wildcard $(TESTSRCDIR)/*.$(SRCFILEEXT))
TESTTARGETS	= $(patsubst $(TESTSRCDIR)/%.$(SRCFILEEXT),$(TESTBINDIR)/%,$(TESTSRCFILES))

OBJFILESNOTARGET= $(patsubst $(BUILDDIR)/$(TARGET).$(OBJFILEEXT),,$(OBJFILES))

.PHONY: build-always-fail

all: $(TESTTARGETS)
	testsh --test

$(TESTBINDIR)/%: $(TESTSRCDIR)/%.$(SRCFILEEXT) build-always-fail
	$(CC) $(CCINCLUDE) $(CCFLAGS) -o $@ $< $(OBJFILESNOTARGET)
